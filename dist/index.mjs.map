{"version":3,"sources":["index.js"],"names":["proxyRead"],"mappings":"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","file":"index.js","sourcesContent":["import {\n\tread as proxyRead\n} from \"@aboutweb/proxyscope\";\n\nconst isBound = /^bound .*$/i;\n\nexport default function ProxyClass(...mixins) {\n\tfunction BaseClass(...args) {\n\t\tlet instance = {};\n\t\tlet stack = mixins.map((mixin) => new mixin(...args));\n\t\tlet proto = Object.getPrototypeOf(this);\n\n\t\tlet proxy = proxyRead(stack, {\n\t\t\tget(target, property, receiver) {\n\t\t\t\tlet desc = (\n\t\t\t\t\tObject.getOwnPropertyDescriptor(proto, property)\n\t\t\t\t\t|| Object.getOwnPropertyDescriptor(proto.prototype || {}, property)\n\t\t\t\t);\n\n\t\t\t\tif(desc) {\n\t\t\t\t\tlet {\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t\tset,\n\t\t\t\t\t\tget\n\t\t\t\t\t} = desc;\n\n\t\t\t\t\tlet result = value || set || get;\n\n\t\t\t\t\tif(typeof result == \"function\") {\n\t\t\t\t\t\treturn result.bind(receiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor(let i = 0, length = stack.length; i < length; i++) {\n\t\t\t\t\tlet level = stack[i];\n\t\t\t\t\tlet value = level[property];\n\n\t\t\t\t\tif(value) {\n\t\t\t\t\t\tif(typeof value == \"function\" && !isBound.test(value.name)) {\n\t\t\t\t\t\t\treturn value.bind(level);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn target[property];\n\t\t\t},\n\t\t\tset(target, property, value) {\n\t\t\t\treturn Reflect.set(instance, property, value);\n\t\t\t},\n\t\t\tgetPrototypeOf(target) {\n\t\t\t\treturn proto;\n\t\t\t}\n\t\t});\n\n\t\tstack.unshift(instance);\n\n\t\treturn proxy;\n\t}\n\n\tBaseClass.prototype = proxyRead(\n\t\tmixins.map((mixin) => Object.create(mixin.prototype))\n\t);\n\n\treturn BaseClass;\n}\n\nProxyClass.hasInstance = function(...mixins) {\n\tlet BaseClass = ProxyClass(...mixins);\n \tlet delegators = new Set([BaseClass]);\n\n\tmixins.forEach(function(value) {\n\t\tif(value.delegators) {\n\t\t\tvalue.delegators.forEach(function(delegator) {\n\t\t\t\tdelegators.add(delegator);\n\t\t\t});\n\t\t}\n\n\t\tdelegators.add(value.prototype.constructor);\n\t});\n\n\tdelegators.forEach(function(delegator) {\n\t\tvar oldInstanceOf = delegator[Symbol.hasInstance];\n\n\t\tObject.defineProperty(\n\t\t\tdelegator,\n\t\t\tSymbol.hasInstance, {\n\t\t\t\tconfigurable : true,\n\t\t\t\tvalue : function(instance) {\n\t\t\t\t\tif(this == delegator) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tBaseClass.prototype.isPrototypeOf(instance)\n\t\t\t\t\t\t\t|| oldInstanceOf.call(delegator, instance)\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn oldInstanceOf.call(this, instance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n\n\tBaseClass.delegators = delegators;\n\n\treturn BaseClass;\n}\n"]}