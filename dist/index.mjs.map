{"version":3,"sources":["index.js"],"names":["ProxyRead"],"mappings":"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","file":"index.js","sourcesContent":["import {\n\tread as ProxyRead\n} from \"@aboutweb/proxyscope\";\n\nconst isBound = /^bound .*$/i;\n\nconst traps = {\n\tget(target, property, receiver) {\n\t\tlet\n\t\t\tstack = target.stack,\n\t\t\tproto = Object.getPrototypeOf(target.proto),\n\t\t\tdesc = (\n\t\t\t\tObject.getOwnPropertyDescriptor(proto || {}, property)\n\t\t\t\t|| Object.getOwnPropertyDescriptor(proto.prototype || {}, property)\n\t\t\t)\n\t\t;\n\n\t\tif(desc) {\n\t\t\tlet {\n\t\t\t\tvalue,\n\t\t\t\tset,\n\t\t\t\tget\n\t\t\t} = desc;\n\n\t\t\tlet result = value || set || get;\n\n\t\t\tif(typeof result == \"function\") {\n\t\t\t\treturn result.bind(receiver);\n\t\t\t}\n\t\t}\n\n\t\tfor(let i = 0, length = stack.length; i < length; i++) {\n\t\t\tlet level = stack[i];\n\t\t\tlet value = level[property];\n\n\t\t\tif(value) {\n\t\t\t\tif(typeof value == \"function\" && !isBound.test(value.name)) {\n\t\t\t\t\treturn value.bind(level);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\treturn target.proto[property];\n\t},\n\tgetPrototypeOf(target) {\n\t\treturn Object.getPrototypeOf(target.proto);\n\t}\n};\n\nexport default function ProxyClass(...mixins) {\n\tfunction BaseClass(...args) {\n\t\treturn ProxyRead({\n\t\t\tproto : this,\n\t\t\tstack : [\n\t\t\t\t{},\n\t\t\t\t...mixins.map((mixin) => new mixin(...args)),\n\t\t\t]\n\t\t}, traps);\n\t}\n\n\tBaseClass.prototype = ProxyRead(\n\t\tmixins.map((mixin) => mixin.prototype)\n\t);\n\n\treturn BaseClass;\n}\n\nProxyClass.hasInstance = function(...mixins) {\n\tlet BaseClass = ProxyClass(...mixins);\n \tlet delegators = new Set([BaseClass]);\n\n\tmixins.forEach(function(value) {\n\t\tif(value.delegators) {\n\t\t\tvalue.delegators.forEach(function(delegator) {\n\t\t\t\tdelegators.add(delegator);\n\t\t\t});\n\t\t}\n\n\t\tdelegators.add(value.prototype.constructor);\n\t});\n\n\tdelegators.forEach(function(delegator) {\n\t\tvar oldInstanceOf = delegator[Symbol.hasInstance];\n\n\t\tObject.defineProperty(\n\t\t\tdelegator,\n\t\t\tSymbol.hasInstance, {\n\t\t\t\tconfigurable : true,\n\t\t\t\tvalue : function(instance) {\n\t\t\t\t\tif(this == delegator) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tBaseClass.prototype.isPrototypeOf(instance)\n\t\t\t\t\t\t\t|| oldInstanceOf.call(delegator, instance)\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn oldInstanceOf.call(this, instance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n\n\tBaseClass.delegators = delegators;\n\n\treturn BaseClass;\n}\n"]}